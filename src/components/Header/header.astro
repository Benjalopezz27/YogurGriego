---
import "../../global.css";
import Toggle from "./toggle.astro";
import Logo from "./logo.astro";
import Nav from "./nav.astro";
---

<div
  id="menuOverlay"
  class="fixed inset-0 bg-black/30 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300 z-40"
>
</div>

<header
  id="site-header"
  class="flex justify-center fixed items-center py-3 sm:py-5 md:py-8 w-full mx-auto px-6 top-0 z-50 backdrop-blur-sm"
>
  <div class="w-full max-w-[1200px] flex items-center justify-between">
    <Logo />
    <Toggle />
    <Nav />
  </div>
</header>

<script>
  const toggle = document.getElementById("menuToggle");
  const menu = document.getElementById("navMenu");
  const overlay = document.getElementById("menuOverlay");

  function openMenu() {
    if (menu && overlay && toggle) {
      menu.classList.remove("scale-y-0", "opacity-0");
      menu.classList.add("scale-y-100", "opacity-100");
      overlay.classList.remove("opacity-0", "pointer-events-none");
      overlay.classList.add("opacity-100", "pointer-events-auto");
      toggle.setAttribute("aria-expanded", "true");
    }
  }

  function closeMenu() {
    if (menu && overlay && toggle) {
      menu.classList.remove("scale-y-100", "opacity-100");
      menu.classList.add("scale-y-0", "opacity-0");
      overlay.classList.remove("opacity-100", "pointer-events-auto");
      overlay.classList.add("opacity-0", "pointer-events-none");
      toggle.setAttribute("aria-expanded", "false");
    }
  }

  if (toggle && menu && overlay) {
    toggle.addEventListener("click", () => {
      const expanded = toggle.getAttribute("aria-expanded") === "true";
      if (expanded) closeMenu();
      else openMenu();
    });

    // click en overlay cierra
    overlay.addEventListener("click", closeMenu);

    // Esc para cerrar
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeMenu();
    });

    // opcional: cerrar al hacer click en un link del menú (útil en mobile)
    menu.querySelectorAll("a").forEach((link) =>
      link.addEventListener("click", () => {
        // solo cerrar en pantallas pequeñas
        if (window.matchMedia("(max-width: 1279px)").matches) closeMenu();
      })
    );
  }
</script>
